---
layout: post
title:  Bypassing Windows Defender in 2025
date:   2025-03-9 22:57:49 +0000
image: assets/img/posts/windefender.png
---

# ilrepack Overview

[ILRepack](https://github.com/gluck/il-repack) is a tool that allows you to merge multiple assemblies into a single assembly.<br>
This can be useful when you deploy an application that has a few dependencies. In this case, you can merge all the dll and the exe into a single exe file, so it's easier to deploy it. It's also useful if you create a NuGet package. In this case, it allows removing the dependencies that you don't want to expose to your consumers.

Although ILRepack is primarily used for legitimate purposes, what if I told you it could be used the other way around? That's right – imagine combining a legitimate file with a malicious one. Could this help evade detection? Let's find out.<br>
In this blog post, we will explore how to obfuscate the well-known and powerful tool [Rubeus](https://github.com/GhostPack/Rubeus), which is commonly used for Active Directory exploitation.

# Step 1: Start From The Basics

As with any obfuscation process, we’ll begin with the most basic techniques.<br> 
This involves cloning the source code of Rubeus, opening it in Visual Studio, and then changing some commonly used names like "Rubeus".  and "Rubeus.exe":


![alt text](/assets/img/posts/ilrepack-1.png)

Next, I'll remove the Rubeus version details from the `info.cs` file:

![alt text](/assets/img/posts/ilrepack-2.png)

*Note: After making this change, be sure to remove `ShowLogo()` from all instances where it is used, as it no longer exists.*

Although there are many other common strings detected by Windows Defender that we can modify, let's move on to the next step.

# Step 2: Changing the Metadata

To modify the metadata of the compiled file, we can use a tool like `Resource Hacker`. This allows us to edit properties such as:

- FileDescription
- Version
- Company Name
- Product Name
- Copyright
- Comments

I will open the compiled file using `Resource Hacker` and change it accordingly:

![alt text](/assets/img/posts/ilrepack-3.png)

I will save the file under a new name `Rubeus-modified.exe` so we can continue progressing with the process.

# Step 3: Reassemble!

Rest assured, our binary is still detected by Windows Defender up to this point:

![alt text](/assets/img/posts/ilrepack-4.png)